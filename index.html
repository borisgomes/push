<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Pushups">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcikiLz4KPHBhdGggZD0iTTYwIDExMEw2MCA3MEg4MEM4OCA3MCA5NSA3NyA5NSA4NVY5NUM5NSAxMDMgOTUgMTAzIDk1IDk1VjEwNUM5NSAxMTMgODggMTIwIDgwIDEyMEg2MFYxMTBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTIwIDcwSDEwMFYxMTBIMTAwVjEyMEgxMjBDMTI4IDEyMCAxMzUgMTEzIDEzNSAxMDVWODVDMTM1IDc3IDEyOCA3MCAxMjAgNzBaIiBmaWxsPSJ3aGl0ZSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyIiB4MT0iMCIgeTE9IjAiIHgyPSIxODAiIHkyPSIxODAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4=">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital@0;1&display=swap" rel="stylesheet">
    <title>Pushup Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #FAFBFD;
            color: #2D3142;
            min-height: 100vh;
            position: relative;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* Progress Section */
        .progress-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 25px;
            color: white;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .total-count {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .total-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: white;
            height: 100%;
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Motivational Quote */
        .quote-section {
            text-align: center;
            padding: 0 20px 20px 20px;
            margin-bottom: 10px;
        }

        .quote-text {
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
            color: #2D3142;
            line-height: 1.5;
            font-weight: 400;
            margin: 0;
            letter-spacing: -0.5px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stats-grid.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #2D3142;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #9CA3AF;
        }

        .stat-card.today {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .stat-card.today .stat-value,
        .stat-card.today .stat-label {
            color: white;
        }

        .stat-card.streak {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .stat-card.streak .stat-value,
        .stat-card.streak .stat-label {
            color: white;
        }

        .streak-emoji {
            display: inline-block;
            margin-left: 5px;
            font-size: 24px;
        }

        /* Prediction Section */
        .prediction-section {
            background: #F3F4F6;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .prediction-text {
            font-size: 15px;
            color: #6B7280;
            margin: 0;
        }

        .prediction-date {
            font-weight: 600;
            color: #667eea;
        }

        /* Weekly Chart */
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        }

        .chart-container {
            margin-top: 20px;
            height: 150px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 8px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 8px 8px 0 0;
            min-height: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #9CA3AF;
            white-space: nowrap;
        }

        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            white-space: nowrap;
        }

        /* Pushup Type Selector */
        .type-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 2px;
        }

        .type-btn {
            padding: 8px 16px;
            background: #F3F4F6;
            border: 2px solid transparent;
            border-radius: 20px;
            font-size: 14px;
            color: #6B7280;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .type-btn:hover:not(.active) {
            border-color: #667eea;
        }

        /* Voice Input Section */
        .voice-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .voice-container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .quick-add-buttons {
            display: flex;
            gap: 8px;
        }

        .quick-add-btn {
            padding: 10px 16px;
            background: #F3F4F6;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-add-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .voice-btn {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .voice-btn:hover {
            transform: scale(1.05);
        }

        .voice-btn.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(102, 126, 234, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
            }
        }

        .voice-btn svg {
            width: 28px;
            height: 28px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        .manual-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .manual-input input {
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 16px;
            width: 100px;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .manual-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .add-btn:hover {
            transform: scale(1.05);
        }

        /* Today's Activity */
        .activity-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2D3142;
        }

        .photo-btn {
            background: #F3F4F6;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 14px;
            color: #6B7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.3s ease;
        }

        .photo-btn:hover {
            background: #E5E7EB;
        }

        .photo-btn svg {
            width: 16px;
            height: 16px;
            stroke: #6B7280;
            stroke-width: 2;
            fill: none;
        }

        .activity-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            font-size: 14px;
            color: #9CA3AF;
        }

        .activity-count {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: #9CA3AF;
            font-size: 14px;
        }

        /* Progress Photos */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .photo-thumb {
            aspect-ratio: 1;
            border-radius: 12px;
            background: #F3F4F6;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .photo-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .voice-status {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #2D3142;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }

        .voice-status.show {
            opacity: 1;
        }

        /* Hidden file input */
        #photoInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Progress Section -->
        <div class="progress-section">
            <div class="total-count" id="totalCount">0</div>
            <div class="total-label">of 10,000 pushups</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0% complete</div>
        </div>

        <!-- Motivational Quote -->
        <div class="quote-section">
            <p class="quote-text" id="dailyQuote">Every pushup is a step closer to your strongest self.</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid three-col">
            <div class="stat-card today">
                <div class="stat-value" id="todayCount">0</div>
                <div class="stat-label">Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPerDay">0</div>
                <div class="stat-label">Daily Avg</div>
            </div>
            <div class="stat-card streak">
                <div class="stat-value">
                    <span id="streakCount">0</span>
                    <span class="streak-emoji">🔥</span>
                </div>
                <div class="stat-label">Day Streak</div>
            </div>
        </div>

        <!-- Progress Prediction -->
        <div class="prediction-section">
            <p class="prediction-text" id="predictionText">Start tracking to see your predicted completion date</p>
        </div>

        <!-- Weekly Chart -->
        <div class="chart-section">
            <h3 class="section-title">This Week</h3>
            <div class="chart-container" id="weeklyChart"></div>
        </div>

        <!-- Today's Activity -->
        <div class="activity-section">
            <div class="section-header">
                <h3 class="section-title">Today's Activity</h3>
                <button class="photo-btn" onclick="document.getElementById('photoInput').click()">
                    <svg viewBox="0 0 24 24">
                        <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                        <circle cx="12" cy="13" r="4"/>
                    </svg>
                    Add Photo
                </button>
            </div>
            <div class="activity-list" id="activityList">
                <div class="empty-state">Start your workout to see activity</div>
            </div>
            <div class="photos-grid" id="photosGrid"></div>
        </div>
    </div>

    <!-- Voice Input Section -->
    <div class="voice-section">
        <div class="voice-container" style="flex-direction: column; gap: 15px;">
            <div class="type-selector">
                <button class="type-btn active" onclick="selectType('normal')">Normal</button>
                <button class="type-btn" onclick="selectType('pike')">Pike</button>
                <button class="type-btn" onclick="selectType('wide')">Wide</button>
                <button class="type-btn" onclick="selectType('elevated')">Elevated</button>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="quick-add-buttons">
                    <button class="quick-add-btn" onclick="addPushups(5)">5</button>
                    <button class="quick-add-btn" onclick="addPushups(10)">10</button>
                </div>
                <div style="position: relative;">
                    <div class="voice-status" id="voiceStatus"></div>
                    <button class="voice-btn" id="voiceBtn">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 1a3 3 0 00-3 3v8a3 3 0 106 0V4a3 3 0 00-3-3z"/>
                            <path d="M19 10v2a7 7 0 01-14 0v-2"/>
                            <path d="M12 19v4"/>
                        </svg>
                    </button>
                </div>
                <div class="quick-add-buttons">
                    <button class="quick-add-btn" onclick="addPushups(15)">15</button>
                    <button class="quick-add-btn" onclick="addPushups(20)">20</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="photoInput" accept="image/*" onchange="handlePhotoUpload(event)">

    <script>
        // Motivational quotes
        const quotes = [
            "Every pushup is a step closer to your strongest self.",
            "Your body can stand almost anything – it's your mind you have to convince.",
            "The pain you feel today will be the strength you feel tomorrow.",
            "Champions are made from something deep inside them – a desire, a dream, a vision.",
            "Success starts with self-discipline.",
            "You don't have to be great to start, but you have to start to be great.",
            "The only bad workout is the one that didn't happen.",
            "Strength doesn't come from what you can do, it comes from overcoming what you once couldn't.",
            "Push yourself because no one else is going to do it for you.",
            "Great things never come from comfort zones.",
            "Your limitation is only your imagination.",
            "It's going to be hard, but hard does not mean impossible.",
            "Dream it, wish it, do it.",
            "Success doesn't just find you – you have to go out and get it.",
            "The harder you work for something, the greater you'll feel when you achieve it.",
            "Don't stop when you're tired, stop when you're done.",
            "Wake up with determination, go to bed with satisfaction.",
            "Do something today that your future self will thank you for.",
            "Little things make big days.",
            "It's never too late to become what you might have been.",
            "The body achieves what the mind believes.",
            "You are stronger than you think.",
            "Every champion was once a contender who refused to give up.",
            "Your only limit is you.",
            "Make yourself proud.",
            "Work hard in silence, let success make the noise.",
            "The pain of discipline weighs ounces, the pain of regret weighs tons.",
            "Results happen over time, not overnight.",
            "Believe in yourself and all that you are.",
            "The difference between try and triumph is a little 'umph'.",
            "Strive for progress, not perfection."
        ];

        // Get daily quote based on date
        function getDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const quoteIndex = dayOfYear % quotes.length;
            return quotes[quoteIndex];
        }

        // Data structure
        let data = {
            total: 0,
            todayCount: 0,
            todayHistory: [],
            photos: [],
            startDate: new Date().toDateString(),
            lastActiveDate: new Date().toDateString(),
            dailyData: {},
            weeklyData: {},
            streak: 0,
            lastStreakDate: null,
            pushupTypes: {
                normal: 0,
                pike: 0,
                wide: 0,
                elevated: 0
            }
        };

        let selectedType = 'normal';

        // Load data from localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem('pushupData');
                if (saved) {
                    data = JSON.parse(saved);
                    // Check if it's a new day
                    if (data.lastActiveDate !== new Date().toDateString()) {
                        data.todayCount = 0;
                        data.todayHistory = [];
                        data.photos = [];
                        data.lastActiveDate = new Date().toDateString();
                        saveData();
                    }
                }
            } catch (e) {
                console.log('localStorage not available');
            }
        }

        // Save data
        function saveData() {
            try {
                localStorage.setItem('pushupData', JSON.stringify(data));
            } catch (e) {
                console.log('Unable to save to localStorage');
            }
        }

        // Calculate streak
        function calculateStreak() {
            const today = new Date();
            const sortedDates = Object.keys(data.dailyData).sort((a, b) => new Date(b) - new Date(a));
            
            if (sortedDates.length === 0) return 0;
            
            let streak = 0;
            let checkDate = new Date(today);
            
            for (let i = 0; i < sortedDates.length; i++) {
                const dateStr = checkDate.toDateString();
                if (data.dailyData[dateStr] && data.dailyData[dateStr] > 0) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else if (i === 0 && today.toDateString() !== sortedDates[0]) {
                    // If today has no pushups yet, check from yesterday
                    checkDate = new Date(sortedDates[0]);
                    if (data.dailyData[checkDate.toDateString()] > 0) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    }
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // Calculate progress prediction
        function calculatePrediction() {
            const daysActive = getDaysActive();
            if (daysActive === 0 || data.total === 0) return null;
            
            const avgPerDay = data.total / daysActive;
            const remaining = 10000 - data.total;
            const daysToComplete = Math.ceil(remaining / avgPerDay);
            
            const predictedDate = new Date();
            predictedDate.setDate(predictedDate.getDate() + daysToComplete);
            
            return {
                date: predictedDate,
                daysRemaining: daysToComplete
            };
        }

        // Get weekly data
        function getWeeklyData() {
            const weekData = [];
            const today = new Date();
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                const dayName = daysOfWeek[date.getDay()];
                const count = data.dailyData[dateStr] || 0;
                
                weekData.push({
                    day: dayName,
                    date: dateStr,
                    count: count,
                    isToday: i === 0
                });
            }
            
            return weekData;
        }

        // Select pushup type
        function selectType(type) {
            selectedType = type;
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Add pushups
        function addPushups(count) {
            const today = new Date().toDateString();
            
            data.total += count;
            data.todayCount += count;
            
            // Update daily data
            if (!data.dailyData[today]) {
                data.dailyData[today] = 0;
            }
            data.dailyData[today] += count;
            
            // Update pushup types
            data.pushupTypes[selectedType] += count;
            
            // Add to history with type
            data.todayHistory.push({
                count: count,
                type: selectedType,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });
            
            updateUI();
            saveData();
            
            // Celebrate milestone
            if (data.total >= 10000 && data.total - count < 10000) {
                alert('🎉 Congratulations! You\'ve completed the 10,000 pushup challenge!');
            }
        }

        // Update UI
        function updateUI() {
            // Update total and progress
            document.getElementById('totalCount').textContent = data.total.toLocaleString();
            const progressPercent = Math.min(100, (data.total / 10000) * 100);
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = progressPercent.toFixed(1) + '% complete';
            
            // Update daily quote
            document.getElementById('dailyQuote').textContent = getDailyQuote();
            
            // Update stats
            document.getElementById('todayCount').textContent = data.todayCount;
            const daysActive = getDaysActive();
            const avgPerDay = daysActive > 0 ? Math.round(data.total / daysActive) : 0;
            document.getElementById('avgPerDay').textContent = avgPerDay;
            
            // Update streak
            const streak = calculateStreak();
            document.getElementById('streakCount').textContent = streak;
            
            // Update prediction
            const prediction = calculatePrediction();
            const predictionEl = document.getElementById('predictionText');
            if (prediction && data.total < 10000) {
                const dateStr = prediction.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                predictionEl.innerHTML = `At this pace, you'll reach 10,000 on <span class="prediction-date">${dateStr}</span> (${prediction.daysRemaining} days)`;
            } else if (data.total >= 10000) {
                predictionEl.innerHTML = '<span class="prediction-date">Congratulations! You\'ve completed the challenge!</span>';
            } else {
                predictionEl.textContent = 'Start tracking to see your predicted completion date';
            }
            
            // Update weekly chart
            updateWeeklyChart();
            
            // Update activity list
            const activityList = document.getElementById('activityList');
            if (data.todayHistory.length > 0) {
                activityList.innerHTML = data.todayHistory.slice().reverse().map(item => `
                    <div class="activity-item">
                        <span class="activity-time">${item.time}</span>
                        <span class="activity-count">+${item.count} ${item.type || 'normal'}</span>
                    </div>
                `).join('');
            } else {
                activityList.innerHTML = '<div class="empty-state">Start your workout to see activity</div>';
            }
            
            // Update photos
            updatePhotosGrid();
        }

        // Update weekly chart
        function updateWeeklyChart() {
            const weekData = getWeeklyData();
            const maxCount = Math.max(...weekData.map(d => d.count), 1);
            const chartContainer = document.getElementById('weeklyChart');
            
            chartContainer.innerHTML = weekData.map(day => {
                const height = day.count > 0 ? (day.count / maxCount) * 100 : 5;
                const barClass = day.isToday ? 'chart-bar today' : 'chart-bar';
                
                return `
                    <div class="${barClass}" style="height: ${height}%;">
                        ${day.count > 0 ? `<div class="chart-bar-value">${day.count}</div>` : ''}
                        <div class="chart-bar-label">${day.day}</div>
                    </div>
                `;
            }).join('');
        }

        // Handle photo upload
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    data.photos.push({
                        src: e.target.result,
                        time: new Date().toISOString()
                    });
                    saveData();
                    updatePhotosGrid();
                };
                reader.readAsDataURL(file);
            }
        }

        // Update photos grid
        function updatePhotosGrid() {
            const grid = document.getElementById('photosGrid');
            if (data.photos.length > 0) {
                grid.innerHTML = data.photos.map(photo => `
                    <div class="photo-thumb">
                        <img src="${photo.src}" alt="Progress photo">
                    </div>
                `).join('');
            } else {
                grid.innerHTML = '';
            }
        }

        // Voice recognition
        let recognition;
        let isListening = false;

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                isListening = true;
                document.getElementById('voiceBtn').classList.add('listening');
                showVoiceStatus('Listening...');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                const number = parseInt(transcript);
                
                if (!isNaN(number) && number > 0 && number < 1000) {
                    addPushups(number);
                    showVoiceStatus(`Added ${number} pushups!`);
                } else {
                    showVoiceStatus('Please say a number');
                }
            };

            recognition.onerror = function(event) {
                showVoiceStatus('Error: ' + event.error);
                isListening = false;
                document.getElementById('voiceBtn').classList.remove('listening');
            };

            recognition.onend = function() {
                isListening = false;
                document.getElementById('voiceBtn').classList.remove('listening');
            };
        }

        // Voice button handler
        document.getElementById('voiceBtn').addEventListener('click', function() {
            if (!recognition) {
                alert('Voice recognition is not supported in your browser.');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (e) {
                    showVoiceStatus('Voice recognition failed');
                }
            }
        });

        // Show voice status
        function showVoiceStatus(message) {
            const status = document.getElementById('voiceStatus');
            status.textContent = message;
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // Manual input
        function addManualPushups() {
            const input = document.getElementById('manualInput');
            const count = parseInt(input.value);
            
            if (!isNaN(count) && count > 0 && count < 1000) {
                addPushups(count);
                input.value = '';
            }
        }

        // Enter key handler
        document.getElementById('manualInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addManualPushups();
            }
        });

        // Initialize
        loadData();
        updateUI();
    </script>
</body>
</html>
